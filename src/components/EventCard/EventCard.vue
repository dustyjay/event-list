<template>
  <div :class="['card', { featured: isFeatured }]">
    <div class="card-img">
      <img v-if="artist.name" :src="artist.image_url" :alt="artist.name" />
      <div v-else>{{ eventName }}</div>
    </div>
    <div :class="['card-content', { column: !isFeatured }]">
      <div class="card__details">
        <section class="card-content__left">
          <h5 class="small">{{ eventName }}</h5>
          <div class="card-row">
            <div class="card-row__with-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8 8.66656C9.10457 8.66656 10 7.77113 10 6.66656C10 5.562 9.10457 4.66656 8 4.66656C6.89543 4.66656 6 5.562 6 6.66656C6 7.77113 6.89543 8.66656 8 8.66656Z"
                  stroke="#6C757D"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8.00005 1.33328C6.58556 1.33328 5.22901 1.89519 4.22881 2.89538C3.22862 3.89557 2.66672 5.25213 2.66672 6.66662C2.66672 7.92795 2.93472 8.75328 3.66672 9.66662L8.00005 14.6666L12.3334 9.66662C13.0654 8.75328 13.3334 7.92795 13.3334 6.66662C13.3334 5.25213 12.7715 3.89557 11.7713 2.89538C10.7711 1.89519 9.41454 1.33328 8.00005 1.33328V1.33328Z"
                  stroke="#6C757D"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>

              Location
            </div>
            <div v-if="isFeatured" class="card-row__with-icon">
              <svg
                width="14"
                height="14"
                viewBox="0 0 14 14"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_0_624)">
                  <path
                    d="M3.9711 0C4.10106 0 4.22569 0.0516249 4.31758 0.143518C4.40948 0.23541 4.4611 0.360044 4.4611 0.49V1.4063H9.723V0.4963C9.723 0.366344 9.77462 0.24171 9.86652 0.149818C9.95841 0.0579249 10.083 0.0063 10.213 0.0063C10.343 0.0063 10.4676 0.0579249 10.5595 0.149818C10.6514 0.24171 10.703 0.366344 10.703 0.4963V1.4063H12.6C12.9712 1.4063 13.3272 1.5537 13.5897 1.8161C13.8522 2.0785 13.9998 2.43442 14 2.8056V12.6007C13.9998 12.9719 13.8522 13.3278 13.5897 13.5902C13.3272 13.8526 12.9712 14 12.6 14H1.4C1.02882 14 0.672829 13.8526 0.410298 13.5902C0.147767 13.3278 0.000185591 12.9719 0 12.6007L0 2.8056C0.000185591 2.43442 0.147767 2.0785 0.410298 1.8161C0.672829 1.5537 1.02882 1.4063 1.4 1.4063H3.4811V0.4893C3.48129 0.359465 3.53299 0.235012 3.62487 0.14327C3.71674 0.0515286 3.84126 -1.32484e-07 3.9711 0V0ZM0.98 5.4194V12.6007C0.98 12.6559 0.990864 12.7105 1.01197 12.7614C1.03308 12.8124 1.06401 12.8587 1.10302 12.8977C1.14202 12.9367 1.18832 12.9676 1.23927 12.9887C1.29023 13.0098 1.34484 13.0207 1.4 13.0207H12.6C12.6552 13.0207 12.7098 13.0098 12.7607 12.9887C12.8117 12.9676 12.858 12.9367 12.897 12.8977C12.936 12.8587 12.9669 12.8124 12.988 12.7614C13.0091 12.7105 13.02 12.6559 13.02 12.6007V5.4292L0.98 5.4194ZM4.6669 10.2333V11.3995H3.5V10.2333H4.6669ZM7.5831 10.2333V11.3995H6.4169V10.2333H7.5831ZM10.5 10.2333V11.3995H9.3331V10.2333H10.5ZM4.6669 7.4494V8.6156H3.5V7.4494H4.6669ZM7.5831 7.4494V8.6156H6.4169V7.4494H7.5831ZM10.5 7.4494V8.6156H9.3331V7.4494H10.5ZM3.4811 2.3856H1.4C1.34484 2.3856 1.29023 2.39646 1.23927 2.41757C1.18832 2.43868 1.14202 2.46961 1.10302 2.50862C1.06401 2.54762 1.03308 2.59392 1.01197 2.64487C0.990864 2.69583 0.98 2.75044 0.98 2.8056V4.4401L13.02 4.4499V2.8056C13.02 2.75044 13.0091 2.69583 12.988 2.64487C12.9669 2.59392 12.936 2.54762 12.897 2.50862C12.858 2.46961 12.8117 2.43868 12.7607 2.41757C12.7098 2.39646 12.6552 2.3856 12.6 2.3856H10.703V3.0359C10.703 3.16586 10.6514 3.29049 10.5595 3.38238C10.4676 3.47428 10.343 3.5259 10.213 3.5259C10.083 3.5259 9.95841 3.47428 9.86652 3.38238C9.77462 3.29049 9.723 3.16586 9.723 3.0359V2.3856H4.4611V3.0296C4.4611 3.15956 4.40948 3.28419 4.31758 3.37608C4.22569 3.46798 4.10106 3.5196 3.9711 3.5196C3.84114 3.5196 3.71651 3.46798 3.62462 3.37608C3.53272 3.28419 3.4811 3.15956 3.4811 3.0296V2.3856Z"
                    fill="#6C757D"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_0_624">
                    <rect width="14" height="14" fill="white" />
                  </clipPath>
                </defs>
              </svg>
              {{ date }}
            </div>
          </div>
          <div class="card-row__with-btn">
            <div class="card-row__with-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9.68663 2.3933C9.59288 2.29966 9.4658 2.24707 9.3333 2.24707C9.2008 2.24707 9.07371 2.29966 8.97996 2.3933L2.3933 8.97996C2.29966 9.07371 2.24707 9.2008 2.24707 9.3333C2.24707 9.4658 2.29966 9.59288 2.3933 9.68663L3.10596 10.3986C3.45442 10.2039 3.8569 10.1283 4.25226 10.1832C4.64762 10.2381 5.01426 10.4205 5.29651 10.7028C5.57875 10.985 5.76117 11.3516 5.81606 11.747C5.87095 12.1424 5.79531 12.5448 5.60063 12.8933L6.3133 13.6066C6.35973 13.6531 6.41486 13.69 6.47555 13.7151C6.53623 13.7402 6.60128 13.7532 6.66696 13.7532C6.73265 13.7532 6.7977 13.7402 6.85838 13.7151C6.91906 13.69 6.9742 13.6531 7.02063 13.6066L13.6066 7.02063C13.7003 6.92688 13.7529 6.7998 13.7529 6.6673C13.7529 6.5348 13.7003 6.40771 13.6066 6.31396L12.8933 5.59996C12.5448 5.79464 12.1424 5.87029 11.747 5.8154C11.3516 5.76051 10.985 5.57809 10.7028 5.29584C10.4205 5.0136 10.2381 4.64695 10.1832 4.25159C10.1283 3.85623 10.2039 3.45375 10.3986 3.1053L9.68663 2.3933ZM8.2733 1.68663C8.41258 1.54734 8.57794 1.43685 8.75993 1.36147C8.94192 1.28608 9.13698 1.24728 9.33396 1.24728C9.53095 1.24728 9.726 1.28608 9.90799 1.36147C10.09 1.43685 10.2553 1.54734 10.3946 1.68663L11.1753 2.46796C11.516 2.80796 11.4553 3.28596 11.2833 3.57463C11.1887 3.73387 11.1499 3.92006 11.173 4.10381C11.196 4.28756 11.2796 4.4584 11.4106 4.58935C11.5415 4.7203 11.7124 4.8039 11.8961 4.82695C12.0799 4.84999 12.2661 4.81118 12.4253 4.71663C12.714 4.5453 13.192 4.48396 13.532 4.82463L14.3133 5.60663C14.4526 5.74592 14.5631 5.91128 14.6385 6.09327C14.7138 6.27526 14.7526 6.47031 14.7526 6.6673C14.7526 6.86428 14.7138 7.05934 14.6385 7.24133C14.5631 7.42332 14.4526 7.58868 14.3133 7.72796L7.72796 14.3133C7.58868 14.4526 7.42332 14.5631 7.24133 14.6385C7.05934 14.7138 6.86428 14.7526 6.6673 14.7526C6.47031 14.7526 6.27526 14.7138 6.09327 14.6385C5.91128 14.5631 5.74592 14.4526 5.60663 14.3133L4.8253 13.5326C4.4853 13.1926 4.5453 12.714 4.7173 12.426C4.81185 12.2667 4.85066 12.0805 4.82761 11.8968C4.80456 11.713 4.72096 11.5422 4.59001 11.4112C4.45906 11.2803 4.28823 11.1967 4.10448 11.1736C3.92073 11.1506 3.73453 11.1894 3.5753 11.284C3.28663 11.4553 2.80863 11.516 2.46863 11.1753L1.68663 10.394C1.54734 10.2547 1.43685 10.0893 1.36147 9.90733C1.28608 9.72534 1.24728 9.53028 1.24728 9.3333C1.24728 9.13631 1.28608 8.94126 1.36147 8.75927C1.43685 8.57728 1.54734 8.41192 1.68663 8.27263L8.2733 1.68663Z"
                  fill="#6C757D"
                />
              </svg>

              Starting from&nbsp;<span class="price">{{ event.amount }}</span>
            </div>
          </div>
        </section>
        <div class="card__tag" v-if="!isFeatured">
          <span>{{ date }}</span>
          <svg
            width="50"
            height="30"
            viewBox="0 0 50 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M6 0H20.0933C19.953 2.19833 21.6845 4.25 24.0903 4.25H25.0756C27.4814 4.25 29.2128 2.19833 29.0726 0H44C47.3137 0 50 2.68629 50 6V24C50 27.3137 47.3137 30 44 30H29.073C29.2132 27.8017 27.4818 25.75 25.076 25.75H24.0907C21.6849 25.75 19.9534 27.8017 20.0937 30H6C2.68629 30 0 27.3137 0 24V6C0 2.68629 2.68629 0 6 0Z"
              fill="#FF6A2C"
              fill-opacity="0.08"
            />
          </svg>
        </div>
      </div>
      <div>
        <buy-ticket :href="event.url">Buy Ticket</buy-ticket>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { computed, defineComponent, reactive } from 'vue';
import EventModel from '@/models/event.model';
import BuyTicket from '../BuyTicket/BuyTicket.vue';

export default defineComponent({
  components: { BuyTicket },
  props: {
    event: {
      type: EventModel,
      required: true
    },
    isFeatured: {
      type: Boolean,
      default: false
    }
  },
  setup({ event, isFeatured }) {
    const state = reactive({ test: 1 });

    const artist = computed(() => {
      return event?.artist;
    });

    const eventName = computed(() => {
      return event.lineup[0];
    });

    const date = computed(() => {
      if (!isFeatured) {
        return new Intl.DateTimeFormat('en-NG', {
          day: '2-digit',
          month: 'short'
        }).format(new Date(event.starts_at));
      }
      // TODO :: use date formatter to refine this
      return new Intl.DateTimeFormat('en-NG', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      }).format(new Date(event.starts_at));
    });

    function incrementTest() {
      state.test += 1;
    }

    return {
      state,
      date,
      artist,
      eventName,
      incrementTest
    };
  }
});
</script>

<style scoped>
@import url('./event-card');
</style>
